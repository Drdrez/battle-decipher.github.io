<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Battle Decipher v9.4 (Full Solutions)</title>
    <style>
        :root { 
            --bg: #0f172a; 
            --card: #1e293b; 
            --text: #e2e8f0; 
            --accent: #3b82f6; 
            --success: #22c55e; 
            --danger: #f59e0b;
            --purple: #a855f7; 
        }
        body { 
            font-family: 'Courier New', monospace; 
            background: var(--bg); 
            color: var(--text); 
            padding: 20px; 
            max-width: 1000px; 
            margin: 0 auto; 
        }
        h1 { 
            text-align: center; 
            color: var(--accent); 
            text-transform: uppercase; 
            letter-spacing: 2px; 
            margin-bottom: 30px;
        }
        
        /* LAYOUT */
        .grid { display: grid; grid-template-columns: 3fr 1fr; gap: 20px; }
        @media (max-width: 768px) { .grid { grid-template-columns: 1fr; } }
        
        /* TABS */
        .tabs { display: flex; gap: 5px; margin-bottom: 20px; flex-wrap: wrap; }
        .tab { 
            flex: 1; 
            padding: 12px; 
            background: #334155; 
            cursor: pointer; 
            text-align: center; 
            font-weight: bold; 
            min-width: 80px; 
            border-radius: 4px 4px 0 0;
            transition: background 0.2s;
        }
        .tab:hover { background: #475569; }
        .tab.active { background: var(--accent); color: white; }
        .tab.dojo-tab { background: #581c87; color: #e9d5ff; border-top: 2px solid var(--purple); }
        .tab.dojo-tab.active { background: var(--purple); color: white; }

        /* PANELS */
        .panel { 
            display: none; 
            background: var(--card); 
            padding: 25px; 
            border-radius: 0 0 8px 8px; 
            border: 1px solid #334155; 
        }
        .panel.active { display: block; }
        
        /* INPUTS */
        textarea, input:not([type="checkbox"]) { 
            width: 100%; 
            padding: 12px; 
            background: #020617; 
            border: 1px solid #334155; 
            color: #fff; 
            font-family: 'Courier New', monospace; 
            box-sizing: border-box; 
            margin-bottom: 15px; 
            border-radius: 4px;
        }
        
        /* BUTTONS */
        .btn-group { display: flex; gap: 10px; margin-top: 10px; }
        button { 
            flex: 1;
            padding: 12px; 
            color: black; 
            font-weight: bold; 
            border: none; 
            cursor: pointer; 
            font-size: 1.1em; 
            border-radius: 4px;
            transition: opacity 0.2s;
        }
        button:hover { opacity: 0.9; }
        .btn-decrypt { background: var(--success); }
        .btn-encrypt { background: var(--danger); }
        .tool-btn { background: #334155; color: white; width: 100%; margin-bottom: 8px; text-align: left; padding: 10px; }

        /* DOJO SPECIFIC BUTTONS */
        .dojo-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px; }
        .btn-gen { background: #334155; color: white; border: 1px solid #475569; padding: 15px; font-size: 0.9em; }
        .btn-gen:hover { background: var(--purple); border-color: var(--purple); }
        
        .difficulty-btns { display: flex; gap: 10px; margin-bottom: 20px; }
        .diff-btn { padding: 10px; border: 2px solid #334155; background: #0f172a; color: #aaa; cursor: pointer; text-align: center; flex: 1; font-weight: bold; border-radius: 4px; }
        .diff-btn:hover { border-color: var(--purple); color: white; }
        .diff-btn.selected { background: var(--purple); color: white; border-color: var(--purple); }
        
        .spoiler { filter: blur(5px); cursor: pointer; transition: 0.3s; background: #333; padding: 10px; border-radius: 4px; }
        .spoiler:hover, .spoiler.revealed { filter: blur(0); background: #000; }

        /* RESULTS & STEP-BY-STEP TABLES */
        .result-box { 
            margin-top: 20px; 
            padding: 15px; 
            background: #000; 
            border-left: 4px solid var(--accent); 
            white-space: pre-wrap; 
            word-break: break-all; 
            font-size: 1.05em;
        }
        .result-row {
            display: flex;
            border-bottom: 1px solid #333;
            padding: 4px 0;
            font-size: 1.1em;
        }
        .result-row:last-child { border: none; }
        .lbl { width: 120px; color: var(--success); font-weight: bold; flex-shrink: 0; }
        
        .step-title { color: var(--purple); font-weight: bold; margin-top: 20px; border-bottom: 1px dashed #334155; padding-bottom: 5px; font-size: 0.9em; text-transform: uppercase; }
        .step-table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 0.9em; background: #111827; }
        .step-table th { background: #334155; color: var(--accent); padding: 8px; border: 1px solid #475569; }
        .step-table td { padding: 8px; border: 1px solid #475569; text-align: center; color: #cbd5e1; }
        .step-table td.math { font-family: monospace; text-align: left; line-height: 1.2; letter-spacing: 1px; }

        /* CHECKBOX ROW */
        .checkbox-row { display: flex; align-items: center; gap: 10px; margin-bottom: 15px; cursor: pointer; background: #1e293b; padding: 5px 0; }
        .checkbox-row input { width: 20px; height: 20px; cursor: pointer; }

        /* SIDEBAR & MISC */
        .tools-panel { background: #111827; padding: 15px; border-radius: 8px; border: 1px solid #334155; height: fit-content; }
        .tool-header { color: var(--accent); font-weight: bold; margin-bottom: 10px; display: block; border-bottom: 1px solid #334155; padding-bottom: 5px; }
        .freq-row { display: flex; justify-content: space-between; font-size: 0.8em; color: #94a3b8; padding: 2px 0; }
        .flex-row { display: flex; gap: 10px; align-items: center; }
        .flex-row > div { flex: 1; }
        .note { font-size: 0.8em; color: #64748b; margin-top: 5px; font-style: italic; }
    </style>
</head>
<body>

    <h1>üîê Battle Decipher v9.4</h1>

    <div class="tabs">
        <div class="tab dojo-tab" onclick="switchTab('dojo')">ü•ã Training Dojo</div>
        <div class="tab active" onclick="switchTab('caesar')">Caesar / Shift</div>
        <div class="tab" onclick="switchTab('xor')">XOR</div>
        <div class="tab" onclick="switchTab('transpo')">Columnar</div>
        <div class="tab" onclick="switchTab('modulo')">Modulo</div>
    </div>

    <div class="grid">
        <div>
            
            <div id="dojo" class="panel">
                <h3>Select Difficulty</h3>
                <div class="difficulty-btns">
                    <div class="diff-btn selected" onclick="setDiff('easy', this)">EASY</div>
                    <div class="diff-btn" onclick="setDiff('medium', this)">MEDIUM</div>
                    <div class="diff-btn" onclick="setDiff('hard', this)">HARD</div>
                </div>
                <h3>Generate Specific Challenge</h3>
                <div class="dojo-grid">
                    <button class="btn-gen" onclick="generatePuzzle('caesar')">üèõÔ∏è Generate Caesar</button>
                    <button class="btn-gen" onclick="generatePuzzle('xor')">‚ö° Generate XOR</button>
                    <button class="btn-gen" onclick="generatePuzzle('transpo')">üìä Generate Transposition</button>
                </div>
                <div id="dojoResult" class="result-box" style="display:none; border-left-color: var(--purple);">
                    <div style="margin-bottom:10px; color: #aaa;">CIPHERTEXT (Copy this):</div>
                    <div id="puzzleText" style="font-size:1.2em; color:white; margin-bottom:20px; user-select: text;"></div>
                    <div style="margin-bottom:5px; color: #aaa;">HINT:</div>
                    <div id="puzzleHint" style="color: var(--accent); margin-bottom:20px;"></div>
                    <div style="margin-bottom:5px; color: #aaa;">ANSWER (Hover to Reveal):</div>
                    <div id="puzzleAnswer" class="spoiler"></div>
                </div>
            </div>

            <div id="caesar" class="panel active">
                <h3>Caesar / Shift Cipher</h3>
                <textarea id="caesarInput" rows="3" placeholder="Enter message..." oninput="updateFreq()"></textarea>
                
                <div class="flex-row">
                    <div>
                        <label>Shift N (+ or -):</label>
                        <input type="number" id="caesarShift" placeholder="Empty = Brute Force">
                    </div>
                    <div style="flex:1.5; font-size:0.85em; color:#aaa; padding-top:25px; line-height: 1.4;">
                        <span style="color:var(--success)">DIRECT CONTROL:</span><br>
                        Input <b>3</b> shifts Right.<br>
                        Input <b>-3</b> shifts Left.
                    </div> 
                </div>

                <div class="btn-group">
                    <button class="btn-decrypt" onclick="solveCaesar(false)">üîì APPLY SHIFT</button>
                    <button class="btn-encrypt" onclick="solveCaesar(true)">üîí APPLY SHIFT</button>
                </div>
                <div id="caesarResult" class="result-box" style="display:none;"></div>
            </div>

            <div id="xor" class="panel">
                <h3>XOR / One-Time Pad</h3>
                <textarea id="xorInput" rows="3" placeholder="Input text or hex..."></textarea>
                <label class="checkbox-row"><input type="checkbox" id="isHex" checked onchange="togglePlaceholder()"> <span>Is input Hex? (Uncheck if input is plain text)</span></label>
                <label>Key:</label><input type="text" id="xorKey" placeholder="Enter Key...">
                <div class="btn-group">
                    <button class="btn-decrypt" onclick="solveXOR(false)">üîì DECRYPT</button>
                    <button class="btn-encrypt" onclick="solveXOR(true)">üîí ENCRYPT</button>
                </div>
                <div id="xorResult" class="result-box" style="display:none;"></div>
            </div>

            <div id="transpo" class="panel">
                <h3>Columnar Transposition</h3>
                <textarea id="transpoInput" rows="3" placeholder="Enter text..."></textarea>
                <label>Key:</label><input type="text" id="transpoKey" placeholder="e.g. 4 3 1 2 or SECRET">
                <div class="btn-group">
                    <button class="btn-decrypt" onclick="runTranspo(false)">üîì DECRYPT</button>
                    <button class="btn-encrypt" onclick="runTranspo(true)">üîí ENCRYPT</button>
                </div>
                <div id="transpoResult" class="result-box" style="display:none;"></div>
            </div>

            <div id="modulo" class="panel">
                <h3>Modulo Calculator</h3>
                <div class="flex-row">
                    <div><label>A:</label><input type="number" id="modA" placeholder="11"></div>
                    <div style="flex:0; font-weight:bold; padding-top:20px">MOD</div>
                    <div><label>B:</label><input type="number" id="modB" placeholder="5"></div>
                </div>
                <button class="btn-decrypt" onclick="solveMod()">CALCULATE</button>
                <div id="modResult" class="result-box" style="display:none; text-align:center; font-size: 2em; color: var(--success);"></div>
            </div>

        </div>

        <div class="tools-panel">
            <span class="tool-header">‚ö° QUICK TOOLS</span>
            <button class="tool-btn" onclick="applyTool('removeSpaces')">Trim Spaces</button>
            <button class="tool-btn" onclick="applyTool('reverse')">Reverse Text</button>
            <button class="tool-btn" onclick="applyTool('upper')">TO UPPERCASE</button>
            <button class="tool-btn" onclick="applyTool('b64')">Base64 Decode</button>
            
            <span class="tool-header" style="margin-top:20px;">üìä FREQUENCY</span>
            <div id="freqChart" style="font-size:0.9em; color:#aaa;">Start typing...</div>
        </div>
    </div>

    <script>
        // --- UI UTILS ---
        let currentDiff = 'easy';
        function setDiff(diff, btn) {
            currentDiff = diff;
            document.querySelectorAll('.diff-btn').forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
        }

        function switchTab(id) {
            document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            event.target.classList.add('active');
        }

        function togglePlaceholder() {
            const isHex = document.getElementById('isHex').checked;
            document.getElementById('xorInput').placeholder = isHex ? "e.g. 1A 2B 3C (Hex)" : "e.g. HELLO WORLD (Text)";
        }

        function getActiveInput() {
            if(document.getElementById('caesar').classList.contains('active')) return document.getElementById('caesarInput');
            if(document.getElementById('xor').classList.contains('active')) return document.getElementById('xorInput');
            if(document.getElementById('transpo').classList.contains('active')) return document.getElementById('transpoInput');
            return null;
        }

        function applyTool(type) {
            const el = getActiveInput();
            if (!el) return;
            let val = el.value;
            if (type === 'removeSpaces') val = val.replace(/\s+/g, '');
            if (type === 'reverse') val = val.split('').reverse().join('');
            if (type === 'upper') val = val.toUpperCase();
            if (type === 'b64') { try { val = atob(val); } catch(e) { alert("Invalid Base64"); } }
            el.value = val;
            if(document.getElementById('caesar').classList.contains('active')) updateFreq();
        }

        function updateFreq() {
            const text = document.getElementById('caesarInput').value.toUpperCase();
            const counts = {};
            let total = 0;
            for (let char of text) {
                if (char >= 'A' && char <= 'Z') { counts[char] = (counts[char] || 0) + 1; total++; }
            }
            if (total === 0) { document.getElementById('freqChart').innerHTML = "No text..."; return; }
            const sorted = Object.keys(counts).sort((a,b) => counts[b] - counts[a]).slice(0, 5); 
            let html = "";
            sorted.forEach(l => {
                let pct = Math.round((counts[l] / total) * 100);
                html += `<div class="freq-row"><span>${l}</span><span>${pct}%</span></div><div style="width:100%; background:#333; height:4px; margin-bottom:6px;"><div style="width:${pct}%; background:#3b82f6; height:100%;"></div></div>`;
            });
            document.getElementById('freqChart').innerHTML = html;
        }

        // --- PUZZLE GENERATOR ---
        const WORDS = ["ATTACKATDAWN", "SECRETCODE", "FLAGISHERE", "HELLOWORLD", "CYBERSECURITY", "ENCRYPTION", "VICTORY", "BATTLEFIELD", "DEFENDTHEFORT"];

        function generatePuzzle(type) {
            const word = WORDS[Math.floor(Math.random() * WORDS.length)];
            let cipher = "", hint = "", answer = word;

            if (type === 'caesar') {
                let shift = 1;
                if (currentDiff === 'easy') shift = 1;
                else if (currentDiff === 'medium') shift = 13;
                else shift = Math.floor(Math.random() * 20) + 2;
                cipher = caesarEngine(word, shift);
                hint = `Method: Caesar (Shift: ${currentDiff === 'hard' ? '???' : '+' + shift})`;
            } 
            else if (type === 'xor') {
                let key = "A";
                if (currentDiff === 'easy') {
                    key = "X"; cipher = xorEncrypt(word, key, false);
                    hint = "Method: XOR (Key: 'X') - Output TEXT";
                } else {
                    key = currentDiff === 'medium' ? "KEY" : "HARD";
                    cipher = xorEncrypt(word, key, true);
                    hint = `Method: XOR (Key: '${key}') - Output HEX`;
                }
            } 
            else if (type === 'transpo') {
                let key = [0,1];
                if (currentDiff === 'easy') { key = [1,0]; hint = "Method: Columnar (Key: 2 1)"; } 
                else if (currentDiff === 'medium') { key = [2,0,1]; hint = "Method: Columnar (Key: 3 1 2)"; } 
                else { key = [3,0,2,1]; hint = "Method: Columnar (Key: 4 1 3 2)"; }
                cipher = columnarEngine(word, key);
            } 

            document.getElementById('dojoResult').style.display = 'block';
            document.getElementById('puzzleText').innerText = cipher;
            document.getElementById('puzzleHint').innerText = hint;
            document.getElementById('puzzleAnswer').innerText = answer;
            document.getElementById('puzzleAnswer').classList.remove('revealed');
        }

        // --- ENGINES ---
        function caesarEngine(str, shift) {
            return str.replace(/[A-Z]/g, c => {
                const code = c.charCodeAt(0);
                return String.fromCharCode(((code - 65 + shift) % 26 + 26) % 26 + 65);
            });
        }
        function columnarEngine(text, keyOrder) {
            let rows = Math.ceil(text.length / keyOrder.length);
            let padded = text.padEnd(rows * keyOrder.length, 'X');
            let grid = [];
            for(let r=0; r<rows; r++) grid.push(padded.substr(r*keyOrder.length, keyOrder.length));
            let out = "";
            for(let k=0; k<keyOrder.length; k++) {
                for(let r=0; r<rows; r++) out += grid[r][keyOrder[k]];
            }
            return out; 
        }
        function xorEncrypt(text, key, toHex) {
            let out = [];
            for(let i=0; i<text.length; i++) {
                let val = text.charCodeAt(i) ^ key.charCodeAt(i%key.length);
                if(toHex) out.push(val.toString(16).toUpperCase().padStart(2,'0'));
                else out.push(String.fromCharCode(val));
            }
            return toHex ? out.join(' ') : out.join('');
        }

        // --- MAIN SOLVERS ---
        function solveCaesar(encrypt) {
            const input = document.getElementById('caesarInput').value;
            const shiftInput = document.getElementById('caesarShift').value;
            let output = "";

            if (shiftInput !== "" && shiftInput !== null) {
                const shift = parseInt(shiftInput);
                const result = caesarEngine(input.toUpperCase(), shift);
                output = `<div class="result-row"><div class="lbl">RESULT:</div><div>${result}</div></div>`;
                output += `<div class="note">Applied Shift: ${shift}</div>`;
            } else {
                for (let s = 1; s < 26; s++) {
                    const result = caesarEngine(input.toUpperCase(), -s);
                    output += `<div class="result-row"><div class="lbl">-${s} / +${26-s}:</div><div>${result}</div></div>`;
                }
            }
            
            document.getElementById('caesarResult').style.display = 'block';
            document.getElementById('caesarResult').innerHTML = output;
        }

        function solveXOR(encrypt) {
            let input = document.getElementById('xorInput').value.trim();
            const key = document.getElementById('xorKey').value;
            const isHex = document.getElementById('isHex').checked;
            if (!key) return;

            let inputBytes = [];
            if (isHex && !encrypt) {
                const cleanHex = input.replace(/[^0-9A-Fa-f]/g, '');
                for (let i = 0; i < cleanHex.length; i += 2) inputBytes.push(parseInt(cleanHex.substr(i, 2), 16));
            } else {
                for (let i = 0; i < input.length; i++) inputBytes.push(input.charCodeAt(i));
            }

            let resultBytes = inputBytes.map((b, i) => b ^ key.charCodeAt(i % key.length));
            let output = encrypt ? 
                resultBytes.map(b => b.toString(16).toUpperCase().padStart(2, '0')).join(' ') : 
                String.fromCharCode(...resultBytes);

            // Generate Step-by-Step Visualization
            let stepHtml = `<div class="step-title">Step-by-Step Binary XOR Breakdown</div>`;
            stepHtml += `<div style="overflow-x:auto;"><table class="step-table">`;
            stepHtml += `<tr><th>Input</th><th>Key</th><th>Binary Calculation</th><th>Result (Hex)</th><th>Result (Char)</th></tr>`;

            for (let i = 0; i < inputBytes.length; i++) {
                let inB = inputBytes[i];
                let kB = key.charCodeAt(i % key.length);
                let resB = resultBytes[i];

                let inBin = inB.toString(2).padStart(8, '0');
                let kBin = kB.toString(2).padStart(8, '0');
                let resBin = resB.toString(2).padStart(8, '0');
                
                let inHex = inB.toString(16).padStart(2,'0').toUpperCase();
                let kHex = kB.toString(16).padStart(2,'0').toUpperCase();
                let resHex = resB.toString(16).padStart(2,'0').toUpperCase();
                
                let inChar = isHex && !encrypt ? inHex : String.fromCharCode(inB).replace(/[\x00-\x1F\x7F-\x9F]/g, '.');
                let kChar = String.fromCharCode(kB).replace(/[\x00-\x1F\x7F-\x9F]/g, '.');
                let resChar = String.fromCharCode(resB).replace(/[\x00-\x1F\x7F-\x9F]/g, '.');

                stepHtml += `<tr>
                    <td>${inChar}<br><span class="note">(0x${inHex})</span></td>
                    <td>${kChar}<br><span class="note">(0x${kHex})</span></td>
                    <td class="math">&nbsp;&nbsp;${inBin}<br>‚äï ${kBin}<br>&nbsp;&nbsp;--------<br>&nbsp;&nbsp;${resBin}</td>
                    <td><b>0x${resHex}</b></td>
                    <td><b>${resChar}</b></td>
                </tr>`;
            }
            stepHtml += `</table></div>`;

            let finalOutput = `<div class="result-row"><div class="lbl">${encrypt ? 'ENCRYPTED' : 'DECRYPTED'}:</div><div style="word-break: break-all;">${output}</div></div>` + stepHtml;

            document.getElementById('xorResult').style.display = 'block';
            document.getElementById('xorResult').innerHTML = finalOutput;
        }

        function runTranspo(encrypt) {
            const text = document.getElementById('transpoInput').value.replace(/\s/g, '');
            let keyStr = document.getElementById('transpoKey').value.trim();
            if (!keyStr || !text) return;

            let keyOrder = [];
            if (/^[\d\s]+$/.test(keyStr)) {
                keyOrder = keyStr.split(/\s+/).map(n => parseInt(n));
                if (!keyOrder.includes(0)) keyOrder = keyOrder.map(n => n - 1);
            } else {
                let keyIndices = [];
                for (let i = 0; i < keyStr.length; i++) keyIndices.push({ char: keyStr[i], index: i });
                keyIndices.sort((a, b) => a.char.localeCompare(b.char));
                keyOrder = keyIndices.map(k => k.index);
            }

            const keyLen = keyOrder.length;
            const rows = Math.ceil(text.length / keyLen);
            const fullCols = text.length % keyLen;

            let stepHtml = `<div class="step-title">Step-by-Step Columnar Breakdown</div>`;

            if(encrypt) {
                let padded = text.padEnd(rows * keyLen, 'X');
                let grid = [];
                for(let r=0; r<rows; r++) grid.push(padded.substr(r*keyLen, keyLen));
                
                stepHtml += `<div class="note" style="margin-bottom:10px;"><b>1. Setup Grid:</b> Text is padded with 'X' to complete the rectangle (${padded.length} chars total).</div>`;
                stepHtml += `<div style="overflow-x:auto;"><table class="step-table"><tr>`;
                for(let i=0; i<keyLen; i++) {
                    let readNum = keyOrder.indexOf(i) + 1; // Determines reading order
                    stepHtml += `<th>Col ${i}<br><span style="color:var(--danger);font-size:0.8em;">(Read #${readNum})</span></th>`;
                }
                stepHtml += `</tr>`;
                for(let r=0; r<rows; r++) {
                    stepHtml += `<tr>` + grid[r].split('').map(c => `<td>${c}</td>`).join('') + `</tr>`;
                }
                stepHtml += `</table></div>`;
                stepHtml += `<div class="note" style="margin-top:10px;"><b>2. Extraction:</b> Read down the columns in the order noted in red above.</div>`;

                let finalOutput = `<div class="result-row"><div class="lbl">ENCRYPTED:</div><div style="word-break: break-all;">${columnarEngine(text, keyOrder)}</div></div>` + stepHtml;
                document.getElementById('transpoResult').style.display = 'block';
                document.getElementById('transpoResult').innerHTML = finalOutput;
            } else {
                let grid = new Array(keyLen).fill("");
                let currentIndex = 0;
                for (let i = 0; i < keyLen; i++) {
                    let targetColIndex = keyOrder[i];
                    let colLength = rows;
                    if (fullCols !== 0 && targetColIndex >= fullCols) colLength = rows - 1;
                    grid[targetColIndex] = text.substr(currentIndex, colLength);
                    currentIndex += colLength;
                }

                stepHtml += `<div class="note" style="margin-bottom:10px;"><b>1. Column Analysis:</b> Text length is ${text.length}. Dividing into ${keyLen} columns. Long columns get ${rows} rows, short columns get ${rows-1} rows.</div>`;
                stepHtml += `<div style="overflow-x:auto;"><table class="step-table"><tr>`;
                for(let i=0; i<keyLen; i++) {
                    let fillNum = keyOrder.indexOf(i) + 1;
                    stepHtml += `<th>Col ${i}<br><span style="color:var(--success);font-size:0.8em;">(Filled #${fillNum})</span></th>`;
                }
                stepHtml += `</tr>`;
                for(let r=0; r<rows; r++) {
                    stepHtml += `<tr>`;
                    for(let c=0; c<keyLen; c++) {
                        let char = (grid[c] && grid[c].length > r) ? grid[c][r] : "<span style='color:#333'>-</span>";
                        stepHtml += `<td>${char}</td>`;
                    }
                    stepHtml += `</tr>`;
                }
                stepHtml += `</table></div>`;
                stepHtml += `<div class="note" style="margin-top:10px;"><b>2. Extraction:</b> Read across the rows left-to-right to reconstruct the message.</div>`;

                let output = "";
                for (let r = 0; r < rows; r++) {
                    for (let c = 0; c < keyLen; c++) {
                        if (grid[c] && grid[c].length > r) output += grid[c][r];
                    }
                }
                
                let finalOutput = `<div class="result-row"><div class="lbl">DECRYPTED:</div><div style="word-break: break-all;">${output}</div></div>` + stepHtml;
                document.getElementById('transpoResult').style.display = 'block';
                document.getElementById('transpoResult').innerHTML = finalOutput;
            }
        }

        function solveMod() {
            const a = parseInt(document.getElementById('modA').value);
            const b = parseInt(document.getElementById('modB').value);
            if (isNaN(a) || isNaN(b) || b === 0) return;
            document.getElementById('modResult').style.display = 'block';
            document.getElementById('modResult').innerText = `Result: ${((a % b) + b) % b}`;
        }
    </script>
</body>
</html>
